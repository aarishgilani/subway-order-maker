<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subway Group Order Exporter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        /* Custom scrollbar for better aesthetics */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #e0e0e0;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background-color: #c0c0c0;
        }
        .select-multiple option:checked {
            background-color: #22c55e; /* Green-500 */
            color: white;
        }
        .subway-green-bg { background-color: #008744; }
        .subway-yellow-text { color: #fcc200; }
        .subway-green-text { color: #008744; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden">
        <!-- Header -->
        <header class="subway-green-bg p-6 text-white text-center rounded-t-xl">
            <h1 class="text-3xl font-bold tracking-tight">Subway Group Order Builder</h1>
            <p class="text-sm font-light subway-yellow-text mt-1">Customize, queue, and export your team's lunch order.</p>
        </header>

        <div class="p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- 1. Sandwich Builder Column (Large Screen: Col 1) -->
            <div class="lg:col-span-1 border-b lg:border-r lg:border-b-0 pb-6 lg:pb-0 lg:pr-6">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2 subway-green-text">Build A Sandwich</h2>
                <form id="orderForm" class="space-y-4">
                    
                    <!-- Customer Name -->
                    <div>
                        <label for="customerName" class="block text-sm font-medium text-gray-700">Order For (Name)</label>
                        <input type="text" id="customerName" required placeholder="e.g., Jane Doe"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-green-500 focus:ring-green-500">
                    </div>
                    
                    <!-- Size & Bread -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="size" class="block text-sm font-medium text-gray-700">Size</label>
                            <select id="size" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white focus:border-green-500 focus:ring-green-500"></select>
                        </div>
                        <div>
                            <label for="bread" class="block text-sm font-medium text-gray-700">Bread</label>
                            <select id="bread" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white focus:border-green-500 focus:ring-green-500"></select>
                        </div>
                    </div>

                    <!-- Protein/Main -->
                    <div>
                        <label for="protein" class="block text-sm font-medium text-gray-700">Protein/Main</label>
                        <select id="protein" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white focus:border-green-500 focus:ring-green-500"></select>
                    </div>

                    <!-- Cheese & Toasting -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="cheese" class="block text-sm font-medium text-gray-700">Cheese</label>
                            <select id="cheese" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white focus:border-green-500 focus:ring-green-500"></select>
                        </div>
                        <div class="flex items-end pb-1">
                             <div class="flex items-center">
                                <input id="toasted" type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <label for="toasted" class="ml-2 block text-sm font-medium text-gray-700">Toast It?</label>
                            </div>
                        </div>
                    </div>

                    <!-- Gluten Free Option (NEW) -->
                    <div class="border-t pt-4">
                        <div class="flex items-center">
                            <input id="glutenFree" type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                            <label for="glutenFree" class="ml-2 block text-sm font-medium text-gray-700">Make it Gluten Free (Wrap/Bread)</label>
                        </div>
                    </div>

                    <!-- Veggies -->
                    <div>
                        <label for="veggies" class="block text-sm font-medium text-gray-700">Veggies (Hold Ctrl/Cmd to select multiple)</label>
                        <select id="veggies" multiple size="6" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white select-multiple focus:border-green-500 focus:ring-green-500 custom-scroll"></select>
                    </div>

                    <!-- Sauces -->
                    <div>
                        <label for="sauces" class="block text-sm font-medium text-gray-700">Sauces (Hold Ctrl/Cmd to select multiple)</label>
                        <select id="sauces" multiple size="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white select-multiple focus:border-green-500 focus:ring-green-500 custom-scroll"></select>
                    </div>

                    <!-- Seasonings/Extras -->
                    <div class="border-t pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Seasonings/Extras</label>
                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input id="salt" type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <label for="salt" class="ml-2 block text-sm font-medium text-gray-700">Salt</label>
                            </div>
                            <div class="flex items-center">
                                <input id="pepper" type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <label for="pepper" class="ml-2 block text-sm font-medium text-gray-700">Pepper</label>
                            </div>
                            <div class="flex items-center">
                                <input id="parmesan" type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <label for="parmesan" class="ml-2 block text-sm font-medium text-gray-700">Parm/Oregano</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                        Add Sandwich to Order
                    </button>
                </form>
            </div>

            <!-- 2. Current Orders Column (Large Screen: Col 2 & 3) -->
            <div class="lg:col-span-2 space-y-6">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2 subway-green-text">Current Order Queue (<span id="orderCount">0</span>)</h2>
                
                <!-- Placeholder Message (Moved outside orderList to prevent deletion) -->
                <p id="emptyMessage" class="text-center text-gray-500 p-4 border rounded-lg bg-gray-50">Add your first sandwich using the builder.</p>

                <!-- Order List (Will be shown/hidden) -->
                <div id="orderList" class="space-y-3 max-h-96 overflow-y-auto custom-scroll p-1 border rounded-lg bg-gray-50 hidden">
                    <!-- Dynamic orders will be injected here -->
                </div>

                <div class="border-t pt-4">
                    <button onclick="clearAllOrders()" id="clearBtn"
                            class="w-full py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                        Clear All Orders
                    </button>
                </div>
                
                <!-- 3. Export Section -->
                <div class="border-t pt-6 space-y-4">
                    <h2 class="text-xl font-semibold subway-green-text">Export Order</h2>

                    <!-- Slack/Text Export -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <label for="slackExport" class="block text-sm font-medium text-gray-700 mb-2">1. Slack/Text Format</label>
                        <textarea id="slackExport" rows="6" readonly
                                  class="block w-full text-sm text-gray-800 rounded-md shadow-inner bg-white p-2 border border-gray-300 custom-scroll"></textarea>
                        <button onclick="copyToClipboard('slackExport', 'Slack')" 
                                class="mt-2 w-full py-2 px-4 text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 transition duration-150 ease-in-out">
                            Copy to Clipboard (Slack)
                        </button>
                    </div>

                    <!-- Spreadsheet/CSV Export -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <label for="csvExport" class="block text-sm font-medium text-gray-700 mb-2">2. Spreadsheet/CSV Format</label>
                        <textarea id="csvExport" rows="4" readonly
                                  class="block w-full text-sm text-gray-800 rounded-md shadow-inner bg-white p-2 border border-gray-300 custom-scroll"></textarea>
                        <button onclick="copyToClipboard('csvExport', 'CSV')" 
                                class="mt-2 w-full py-2 px-4 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition duration-150 ease-in-out">
                            Copy to Clipboard (CSV)
                        </button>
                    </div>

                     <!-- Custom Alert Box -->
                    <div id="alertBox" class="fixed top-4 right-4 bg-gray-800 text-white p-3 rounded-lg shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none" role="alert">
                        Copied to Clipboard!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Mock Menu Data (Based on common Subway options) ---
        // This data has been updated to reflect common and current menu items.
        const MENU_OPTIONS = {
            sizes: ['6-inch', 'Footlong'],
            breads: [
                'Artisan Italian (White)', 
                '9-Grain Wheat', 
                'Italian Herbs & Cheese', 
                'Hearty Multigrain',
                'Artisan Flatbread'
            ],
            proteins: [
                'Tuna', 'Bacon, Egg & Cheese', 'Meatball Marinara', 'Turkey Breast', 
                'Italian BMT', 'Spicy Italian', 'Steak & Cheese', 'Veggie Delight'
            ],
            cheeses: [
                'American', 
                'Monterey Cheddar', 
                'Provolone', 
                'Pepper Jack', 
                'Shredded Mozzarella',
                'No Cheese'
            ],
            veggies: [
                'Lettuce', 'Tomatoes', 'Cucumbers', 'Green Peppers', 'Red Onions', 
                'Black Olives', 'Pickles', 'Jalapeños', 'Banana Peppers', 'Spinach',
            ],
            sauces: [
                'Mayonnaise', 'Ranch', 'Chipotle Southwest', 'Sweet Onion Teriyaki', 
                'Honey Mustard', 'Sub Sauce', 'Buffalo Sauce', 'Sriracha', 'No Sauce' // UPDATED
            ]
        };

        // --- State Management ---
        let orders = [];

        // --- Utility Functions ---

        /**
         * Fills a <select> element with options from the MENU_OPTIONS.
         * @param {string} elementId - The ID of the select element.
         * @param {string[]} options - Array of string options.
         * @param {boolean} [isMulti=false] - If true, adds a default selection message.
         */
        function populateSelect(elementId, options, isMulti = false) {
            const select = document.getElementById(elementId);
            if (!isMulti) {
                // Add default placeholder for single-select dropdowns
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = `-- Select ${elementId.charAt(0).toUpperCase() + elementId.slice(1)} --`;
                defaultOption.disabled = true;
                defaultOption.selected = true;
                select.appendChild(defaultOption);
            }
            options.forEach(optionText => {
                const option = document.createElement('option');
                option.value = optionText;
                option.textContent = optionText;
                select.appendChild(option);
            });
        }

        /**
         * Converts the current orders array into a clean text string for Slack.
         * @returns {string} The formatted text.
         */
        function generateSlackExport() {
            if (orders.length === 0) return "The order queue is currently empty.";

            let output = "--- Subway Group Order ---\n";
            output += `Total Sandwiches: ${orders.length}\n\n`;

            orders.forEach((order, index) => {
                const extras = [];
                if (order.toasted) extras.push('TOASTED');
                if (order.glutenFree) extras.push('GLUTEN FREE'); // NEW
                if (order.salt) extras.push('Salt');
                if (order.pepper) extras.push('Pepper');
                if (order.parmesan) extras.push('Parm/Oregano');
                
                const extrasStr = extras.length > 0 ? `(${extras.join(', ')})` : '';

                output += `*${index + 1}. ${order.customerName}*\n`;
                output += `  • Item: ${order.protein} (${order.size} on ${order.bread} ${extrasStr})\n`;
                output += `  • Cheese: ${order.cheese}\n`;
                output += `  • Veggies: ${order.veggies.join(', ') || 'None'}\n`;
                output += `  • Sauces: ${order.sauces.join(', ') || 'None'}\n`;
                output += "\n";
            });
            return output.trim();
        }

        /**
         * Converts the current orders array into a CSV string.
         * @returns {string} The CSV data.
         */
        function generateCSVExport() {
            if (orders.length === 0) return "Name,Item,Size,Bread,Toasted,GlutenFree,Salt,Pepper,Parmesan,Cheese,Veggies,Sauces\n";

            // Define CSV Headers - updated to include new seasonings
            const header = "Name,Item,Size,Bread,Toasted,GlutenFree,Salt,Pepper,Parmesan,Cheese,Veggies,Sauces"; 
            let csv = header + "\n";

            orders.forEach(order => {
                // Escape commas in multi-select fields by wrapping them in double quotes
                const veggies = `"${order.veggies.join(', ')}"`;
                const sauces = `"${order.sauces.join(', ')}"`;
                
                const row = [
                    order.customerName,
                    order.protein,
                    order.size,
                    order.bread,
                    order.toasted ? 'Yes' : 'No',
                    order.glutenFree ? 'Yes' : 'No', 
                    order.salt ? 'Yes' : 'No',
                    order.pepper ? 'Yes' : 'No',
                    order.parmesan ? 'Yes' : 'No',
                    order.cheese,
                    veggies,
                    sauces
                ].join(',');
                csv += row + "\n";
            });
            return csv.trim();
        }

        /**
         * Renders the current list of orders and updates export fields.
         */
        function renderOrders() {
            const listContainer = document.getElementById('orderList');
            const emptyMessage = document.getElementById('emptyMessage');
            const orderCount = document.getElementById('orderCount');
            
            listContainer.innerHTML = ''; // Safe to clear now that emptyMessage is external
            orderCount.textContent = orders.length;

            if (orders.length === 0) {
                // Show empty message, hide order list
                emptyMessage.classList.remove('hidden');
                listContainer.classList.add('hidden');

                document.getElementById('slackExport').value = generateSlackExport();
                document.getElementById('csvExport').value = generateCSVExport();
                return;
            } else {
                // Hide empty message, show order list
                emptyMessage.classList.add('hidden');
                listContainer.classList.remove('hidden');
            }

            orders.forEach((order, index) => {
                const orderItem = document.createElement('div');
                orderItem.className = "p-3 bg-white border border-gray-200 rounded-lg shadow-sm flex justify-between items-center";

                const extras = [];
                if (order.toasted) extras.push('Toasted');
                if (order.glutenFree) extras.push('Gluten Free'); 
                if (order.salt) extras.push('Salt');
                if (order.pepper) extras.push('Pepper');
                if (order.parmesan) extras.push('Parm/Oregano');
                
                const extrasStr = extras.length > 0 ? `, ${extras.join(', ')}` : '';
                
                const details = `
                    <div class="flex-grow">
                        <p class="font-bold text-gray-900">${order.customerName}</p>
                        <p class="text-sm text-gray-800 font-semibold">${order.protein} (${order.size} on ${order.bread}${extrasStr})</p>
                        <p class="text-sm text-gray-600 mt-1">
                            ${order.cheese} | Veggies: ${order.veggies.join(', ') || 'None'} | Sauces: ${order.sauces.join(', ') || 'None'}
                        </p>
                    </div>
                `;
                orderItem.innerHTML = details;
                
                // Delete Button
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Remove';
                deleteBtn.className = 'ml-4 px-3 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-full hover:bg-red-200 transition duration-150';
                deleteBtn.onclick = () => removeOrder(index);
                
                orderItem.appendChild(deleteBtn);
                listContainer.appendChild(orderItem);
            });

            // Update export fields
            document.getElementById('slackExport').value = generateSlackExport();
            document.getElementById('csvExport').value = generateCSVExport();
        }

        /**
         * Removes an order from the list by index.
         * @param {number} index - The index of the order to remove.
         */
        function removeOrder(index) {
            orders.splice(index, 1);
            renderOrders();
        }

        /**
         * Clears the entire orders list.
         */
        function clearAllOrders() {
            if (orders.length === 0) return;
            // Use a custom modal in a real app, but for simplicity here, we'll confirm via console logging.
            console.log("All orders cleared.");
            orders = [];
            renderOrders();
        }


        /**
         * Copies the content of a textarea to the clipboard and shows an alert.
         * @param {string} elementId - The ID of the textarea element.
         * @param {string} formatName - The name of the format (Slack or CSV).
         */
        function copyToClipboard(elementId, formatName) {
            const textarea = document.getElementById(elementId);
            
            // Check if there is anything to copy
            if (textarea.value.includes("empty")) {
                console.warn(`Cannot copy: ${formatName} export is empty.`);
                return;
            }

            // Select the text
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                // Use execCommand for broader compatibility in sandboxed environments
                document.execCommand('copy');
                
                const alertBox = document.getElementById('alertBox');
                alertBox.textContent = `${formatName} Copied!`;
                alertBox.classList.remove('opacity-0', 'pointer-events-none');
                alertBox.classList.add('opacity-100');

                setTimeout(() => {
                    alertBox.classList.remove('opacity-100');
                    alertBox.classList.add('opacity-0', 'pointer-events-none');
                }, 2000);

            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        }
        
        // --- Event Listener for Form Submission ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Populate all select menus
            populateSelect('size', MENU_OPTIONS.sizes);
            populateSelect('bread', MENU_OPTIONS.breads);
            populateSelect('protein', MENU_OPTIONS.proteins); 
            populateSelect('cheese', MENU_OPTIONS.cheeses);
            populateSelect('veggies', MENU_OPTIONS.veggies, true);
            populateSelect('sauces', MENU_OPTIONS.sauces, true);
            
            // Initial render
            renderOrders();

            // 2. Set up form submission handler
            const form = document.getElementById('orderForm');
            form.addEventListener('submit', (e) => {
                e.preventDefault();

                const customerName = document.getElementById('customerName').value.trim();
                const size = document.getElementById('size').value;
                const bread = document.getElementById('bread').value;
                const protein = document.getElementById('protein').value;
                const cheese = document.getElementById('cheese').value;
                const toasted = document.getElementById('toasted').checked;
                
                // NEW: Gluten Free capture
                const glutenFree = document.getElementById('glutenFree').checked;

                // Seasonings/Extras capture
                const salt = document.getElementById('salt').checked;
                const pepper = document.getElementById('pepper').checked;
                const parmesan = document.getElementById('parmesan').checked;
                
                // Get multi-select values
                const veggies = Array.from(document.getElementById('veggies').selectedOptions).map(o => o.value);
                const sauces = Array.from(document.getElementById('sauces').selectedOptions).map(o => o.value);

                // Construct new order object
                const newOrder = {
                    customerName: customerName,
                    size: size,
                    bread: bread,
                    protein: protein, 
                    cheese: cheese,
                    toasted: toasted,
                    glutenFree: glutenFree, // NEW
                    salt: salt,
                    pepper: pepper,
                    parmesan: parmesan,
                    veggies: veggies,
                    sauces: sauces
                };

                // Add to state and re-render
                orders.push(newOrder);
                renderOrders();

                // Reset form inputs (but keep name for potential re-order)
                form.reset();
                document.getElementById('customerName').value = customerName; // Keep name field populated
            });
        });
    </script>
</body>
</html>
